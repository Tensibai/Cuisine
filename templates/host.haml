- nb_runs = @config["host_nb_runs"]
- if @infos.count < nb_runs
  - nb_runs = @infos.count-1
%div{:class => "row" }
  %div{:class => "span10" }
    %h2
      #{@infos[0][:nodename]}

    %h3
      Various informations
    %div
      %strong
        Latest run :
      #{@infos[0][:start_time]}
    %div
      %strong
        Last run changes :
      - if @infos[0][:updated_resources].empty? then
      %span{:class => "notice label"} No resources updated
      - else
        %span
        %ul
          - @infos[0][:updated_resources].each do |res|
            %li
              #{res}

    %div
      %strong
        Short history (#{@infos.count} latest runs) :
      %ul
      - for i in 0..nb_runs do
        - if @infos[i][:start_time] then
          %li
            #{@infos[i][:start_time]} |
            - |
            %a{:href => "/run/#{@infos[i][:id]}"}
              summary
    %p
    %div
      %strong
        Last runs duration, in seconds :
      %p
      %div{:id => "placeholder", :style=>"width:600px;height:300px;"}

      - graph_coords=[]
      - times=[]
      - for i in 0..nb_runs do
        - if @infos[i][:elapsed_time] then
          - graph_coords.push "[#{i+1}, #{sprintf("%.1f",@infos[i][:elapsed_time].to_f)}]"
          - times.push sprintf("%.1f", @infos[i][:elapsed_time]).to_f
      - graph_points="[#{graph_coords.join(', ')}]"
  :javascript
    $(function () {
      var graphdata = #{graph_points};
      $.plot($("#placeholder"), [ graphdata ], {
        series: {
          lines: { show: true },
          points: { show: true },
        },
        grid: {
          show: true
        },
        yaxis: {
          min: #{times.min - 1},
          max: #{times.max + 1},
          ticks: #{times.count+1}
        }
      }    );
    });
